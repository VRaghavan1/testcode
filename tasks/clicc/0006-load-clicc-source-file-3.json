{
  "tasks": [

    {
      "taskCode": "JsonLineFileToJson",
      "taskConfigurationTemplate": {
        "in": "{DATA_PROCESSING_FOUNDATION}/{TEMPDIRECTORY}/clicc-source.jsonl.3",
        "params": { 
        }
      }
    },
   {
      "taskCode": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [

            {
            "matchConfiguration": {
              "customerCode": "{CUSTOMER_CODE}",
              "dataRepositoryCode": "{DATA_REPOSITORY_CODE}",
              "dataCollectionCode": "clicc-system-to-city-source",
              "baseRecordLookupPropertyName": "SYSTEM_TABNUM",
              "lookupIdPropertyNames": ["SYSTEM_TABNUM.raw"],
              "uniqueRecords": false
            },
            "enrichConfiguration": {
              "ute~sku~channel~system~cities": [
                "$.matchingRecords[*].CITY"
              ],
              "ute~sku~channel~province": "$.matchingRecords[*].PROVINCE",
              "ute~sku~channel~stb": "$.matchingRecords[*].STB"
            }
          }
          ]
        }
      }
    },
    {
      "taskCode": "KeepUniqueValues-1",
      "taskClass": "KeepUniqueValues",
      "taskConfigurationTemplate": {
        "params": {
          "property": [
            "ute~sku~channel~system~cities"
          ]
        }
      }
    },

     {
     "taskClass": "FilterDataRecord",
     "taskCode": "FilterDataRecord-Site",
     "taskConfigurationTemplate": {
       "params": {
         "condition": {
           "$or": [
            {"$and": [
              {"ute~sku~channel~stb": {"$eq": "SD"} },
              {"ute~sku~channel~province": {"$ne": "ON"} }
            ]},
            {"$and": [
              {"ute~sku~channel~stb": {"$eq": "HD"} },
              {"ute~sku~channel~province": {"$eq": "ON"} }
            ]}
           ]
         }
       }
     }
   },
//    {
//      "taskCode": "Debug",
//      "taskConfigurationTemplate": {
//        "params": {}
//      }
//    },
     {
       "taskCode": "DataRecordToDataRepositoryBulk",
       "taskConfigurationTemplate": {
         "params": {
           "datareposervice_host": "{DATA_REPOSITORY_SERVICE_HOST}",
           "datareposervice_port": "{DATA_REPOSITORY_SERVICE_PORT}",
           "customerCode": "{CUSTOMER_CODE}",
           "dataRepositoryCode": "{DATA_REPOSITORY_CODE}",
           "dataCollectionCode": "clicc-channels-source"
         }
       }
     }
  ]
}

