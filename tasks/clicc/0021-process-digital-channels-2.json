{
  "tasks": [
    {
      "taskCode": "JsonLineFileToJson",
      "taskConfigurationTemplate": {
        "in": "{DATA_PROCESSING_FOUNDATION}/{TEMPDIRECTORY}/0020-export-digital-channels.jsonl.2",
        "params": { 
        }
      }
    },
    {
      "taskCode": "Shell-RM",
      "taskConfigurationTemplate": {
        "params": {
          "options": "-f",
          "filename": "{DATA_PROCESSING_FOUNDATION}/{TEMPDIRECTORY}/{TASK_FILENAME}.xml"
        }
      }
    },
    {
      "taskCode": "GetSystems",
      "taskClass": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [
            {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "clicc-channels-source",
              "baseRecordLookupPropertyName": "SERVICE_ID",
              "lookupIdPropertyNames": ["SERVICE_ID"],
              "uniqueRecords": true
            },
            "enrichConfiguration": {
              "systemId": [
                "$.matchingRecords[*].SYSTEM_TABNUM"
              ]
            }
          }
          ]
        }
      }
    },
    {
      "taskClass": "KeepUniqueValues",
      "taskCode": "KeepUniqueValues-System",
      "taskConfigurationTemplate": {
        "params": {
          "property": ["systemId"]
        }
      }
    },
    {
      "taskClass": "NormalizeDataRecord",
      "taskCode": "NormalizeDataRecord-System",
      "taskConfigurationTemplate": {
        "params": {
          "property": ["systemId"]
        }
      }
    },

    {
      "taskCode": "HydrateDataRecord2",
      "taskClass": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [
            {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "clicc-channels-source",
              "baseRecordLookupPropertyName": "SERVICE_ID",
              "lookupIdPropertyNames": ["SERVICE_ID"],
              "uniqueRecords": true,
              "lookupFilter": {
                "propertyName": "SYSTEM_TABNUM.raw",
                "operation": "term",
                "value": "{{{systemId}}}"
              }
            },
            "enrichConfiguration": {
              "ute~sku~channel~system~names": [
                "$.matchingRecords[*].SYSTEM_NAME"
              ],
              "ute~sku~channel~channelNumbers": [
                "$.matchingRecords",
                {
                  "channel.id":"CHANNEL_ID",
                  "channel.number":"CHANNEL_NUM"
                }
              ],
              "ute~sku~channel~productCode": [
                "$.matchingRecords[*].PRODUCT_CODE"
              ],
              "ute~sku~channel~system~cities": "$.matchingRecords[*].ute~sku~channel~system~cities",
              "ute~province": "$.matchingRecords[*].ute~sku~channel~province",
              "province": "$.matchingRecords[*].ute~sku~channel~province",
              "ute~sku~channel~stb": "$.matchingRecords[*].ute~sku~channel~stb"
            }
          }
          ]
        }
      }
    },

   {
      "taskCode": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [

            {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "clicc-pom-to-clicc-source",
              "baseRecordLookupPropertyName": "SERVICE_ID",
              "lookupIdPropertyNames": ["SERVICE_ID"],
              "uniqueRecords": true
            },
            "enrichConfiguration": {
              "ute.sku.channel.pom.id": [
                "$.matchingRecords[*].POM_ID"
              ]
            }
          },
          {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "clicc-channels-properties",
              "baseRecordLookupPropertyName": "SERVICE_ID",
              "lookupIdPropertyNames": ["SERVICE_ID.raw"],
              "uniqueRecords": true
            },
            "enrichConfiguration": {
              "ute.sku.channel.title.en": "$.matchingRecords[0].EXTERNAL_NAME_EN",
              "ute.sku.channel.title.fr": "$.matchingRecords[0].EXTERNAL_NAME_FR",
              "ute.sku.channel.shortDescription.en": "$.matchingRecords[0].CHANNEL_DESCRIPTION_EN",
              "ute.sku.channel.shortDescription.fr": "$.matchingRecords[0].CHANNEL_DESCRIPTION_FR",
              "ute.image.1": "$.matchingRecords[0].CHANNEL_LOGO",
              "ute.image.2": "$.matchingRecords[0].CHANNEL_LOGO",
              "ute.image.3": "$.matchingRecords[0].CHANNEL_LOGO",
              "ute.sku.channel.websiteUrl": "$.matchingRecords[0].WEBSITE_URL"
            }
          },

          {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "pom-ptv-extract-source",
              "baseRecordLookupPropertyName": "ute.sku.channel.pom.id",
              "lookupIdPropertyNames": ["CHANNELID.raw"],
              "uniqueRecords": true,
              "lookupFilter": [{
                "propertyName": "LANG.raw",
                "operation": "term",
                "value": "EN"
              },{
                "propertyName": "REGION.raw",
                "operation": "term",
                "value": "{{{province}}}"
              },{
                "propertyName": "SYSTEM_TABNUM.raw",
                "operation": "term",
                "value": "{{{systemId}}}"
              }]
            },
            "enrichConfiguration": {
              "ute.sku.channel.packages": [
                "$.matchingRecords",
                {
                  "ute.package.id": "PK_SOC",
                  "ute.name.en": "PKG_NAME"
                }
              ],
              "ute.sku.channel.package.names.en": ["$.matchingRecords[*].PKG_NAME"],
              "ute.sku.channel.genre.en": "$.matchingRecords[*].GENRE_DESC",
              "ute.sku.channel.package.id": ["$.matchingRecords[*].PK_SOC"]
            }
          },
          {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "pom-ptv-extract-source",
              "baseRecordLookupPropertyName": "ute.sku.channel.pom.id",
              "lookupIdPropertyNames": ["CHANNELID.raw"],
              "uniqueRecords": true,
              "lookupFilter": [{
                "propertyName": "LANG.raw",
                "operation": "term",
                "value": "FR"
              },{
                "propertyName": "REGION.raw",
                "operation": "term",
                "value": "{{{province}}}"
              },{
                "propertyName": "SYSTEM_TABNUM.raw",
                "operation": "term",
                "value": "{{{systemId}}}"
              }]

            },
            "enrichConfiguration": {
              "ute.sku.channel.packages": [
                "$.matchingRecords",
                {
                  "ute.package.id": "PK_SOC",
                  "ute.name.fr": "PKG_NAME"
                }
              ],
              "ute.sku.channel.genre.fr": "$.matchingRecords[*].GENRE_DESC"
            }
          },
          {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "pom-themepack-source",
              "baseRecordLookupPropertyName": "ute.sku.channel.pom.id",
              "lookupIdPropertyNames": ["CHANNELSLIST.raw"],
              "uniqueRecords": true,
              "lookupFilter": [{
                "propertyName": "LANG.raw",
                "operation": "term",
                "value": "EN"
              }, {
                "propertyName": "REGION.raw",
                "operation": "term",
                "value": "{{{province}}}"
              }]
            },
            "enrichConfiguration": {
              "ute.sku.channel.themePacks": [
                "$.matchingRecords",
                {
                  "ute.themePack.id": "SOC",
                  "ute.name.en": "CMS_PRODUCT_TITLE",
                  "ute.region":"REGION"
                }
              ],
              "ute.sku.channel.themePack.names.en": ["$.matchingRecords[*].CMS_PRODUCT_TITLE"]
            }
          },
          {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "pom-themepack-source",
              "baseRecordLookupPropertyName": "ute.sku.channel.pom.id",
              "lookupIdPropertyNames": ["CHANNELSLIST.raw"],
              "uniqueRecords": true,
              "lookupFilter": [{
                "propertyName": "LANG.raw",
                "operation": "term",
                "value": "FR"
              }, {
                "propertyName": "REGION.raw",
                "operation": "term",
                "value": "{{{province}}}"
              }]
            },
            "enrichConfiguration": {
              "ute.sku.channel.themePacks": [
                "$.matchingRecords",
                {
                  "ute.name.fr": "CMS_PRODUCT_TITLE"
                }
              ],
              "ute.sku.channel.themePack.names.fr": ["$.matchingRecords[*].CMS_PRODUCT_TITLE"]
            }
          },
          {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "alacarte-channels-source",
              "baseRecordLookupPropertyName": "ute~sku~channel~productCode",
              "lookupIdPropertyNames": ["CLICC_CODE.raw"],
              "uniqueRecords": true
            },
            "enrichConfiguration": {
              "ute~sku~channel~alacarte": ["$.matchingRecords[*].CLICC_CODE"]
            }
          },
          {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "ptv-channel-source",
              "baseRecordLookupPropertyName": "ute~sku~channel~productCode",
              "lookupIdPropertyNames": ["CHANNELID.raw"],
              "uniqueRecords": true
            },
            "enrichConfiguration": {
              "ute~sku~channel~price": "$.matchingRecords[*].CHANNEL_PRICE"
            }
          }

        ]
      }
      }
    },
    {
      "taskCode": "isAlacarte",
      "taskClass": "RunScriptComponent",
      "taskConfigurationTemplate": {
        "params": {
          "script":
          "dataRecord['ute~sku~channel~alacarte'] = dataRecord['ute~sku~channel~alacarte'].length > 0 ? 'true' : 'false';"
        }
      }
    },
    {
        "taskCode": "GetFrenchChannelPackageName",
        "taskClass": "HydrateDataRecord",
        "taskConfigurationTemplate": {
          "params": {
              "hydrate_configuration": [
              {
                "matchConfiguration": {
                  "customerCode": "rogers",
                  "dataRepositoryCode": "eclipse-dev",
                  "dataCollectionCode": "teamsite-channel-content-source",
                  "baseRecordLookupPropertyName": "ute.sku.channel.package.id",
                  "lookupIdPropertyNames": ["french.product_info.product_ID.raw"],
                  "uniqueRecords": true,
                  "lookupFilter": [{
                    "propertyName": "french.product_type.raw",
                    "operation": "term",
                    "value": "PTV_PACKAGE"
                  }]
                },
                "enrichConfiguration": {
                  "ute.sku.channel.package.names.fr":["$.matchingRecords[*].french.product_info.product_title"]
                }
              }
            ]
          }
        }
      },
   {
      "taskCode": "GetShows",
      "taskClass": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [
          {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "featured-shows-record",
              "baseRecordLookupPropertyName": "SERVICE_CALLSIGN",
              "lookupIdPropertyNames": ["ute~content~show~channel~cliccCallSign.raw"],
              "uniqueRecords": true
            },
            "enrichConfiguration": {
              "ute.sku.channel.shows.en": [
                "$.matchingRecords[*].ute~name~en"
              ],
              "ute.sku.channel.shows.fr": [
                "$.matchingRecords[*].ute~name~fr"
              ]
            }
          }
        ]
      }
      }
    },
   // {
   //    "taskCode": "GetCast",
   //    "taskClass": "HydrateDataRecord",
   //    "taskConfigurationTemplate": {
   //      "params": {
   //        "hydrate_configuration": [
   //        {
   //          "matchConfiguration": {
   //            "customerCode": "rogers",
   //            "dataRepositoryCode": "eclipse-dev",
   //            "dataCollectionCode": "omdb",
   //            "baseRecordLookupPropertyName": "ute.sku.channel.shows.en",
   //            "lookupIdPropertyNames": ["Title"],
   //            "uniqueRecords": true,
   //            "useSearch": true
   //          },
   //          "enrichConfiguration": {
   //            "ute.sku.channel.shows.cast": [
   //              "$.matchingRecords[0].Cast"
   //            ]
   //          }
   //        }
   //      ]
   //    }
   //    }
   //  }
   //  ,
    // {
    //   "taskCode": "SplitProperty",
    //   "taskConfigurationTemplate": {
    //     "params": {
    //       "property": ["ute.sku.channel.shows.en","ute.sku.channel.shows.fr"],
    //       "separator": "\n"
    //     }
    //   }
    // },
    {
      "taskCode": "SplitGenreEnglish",
      "taskClass": "RunScriptComponent",
      "taskConfigurationTemplate": {
        "params": {
          "script":
          "if (dataRecord['ute.sku.channel.genre.en']) { dataRecord['ute.sku.channel.subgenre.en'] = dataRecord['ute.sku.channel.genre.en'].split('/')[1]; dataRecord['ute.sku.channel.genre.en'] = dataRecord['ute.sku.channel.genre.en'].split('/')[0]; } "
        }
      }
    },
    {
      "taskCode": "SplitGenreFrench",
      "taskClass": "RunScriptComponent",
      "taskConfigurationTemplate": {
        "params": {
          "script":
          "if (dataRecord['ute.sku.channel.genre.fr']) {dataRecord['ute.sku.channel.subgenre.fr'] =  dataRecord['ute.sku.channel.genre.fr'].split('/')[1]; dataRecord['ute.sku.channel.genre.fr'] = dataRecord['ute.sku.channel.genre.fr'].split('/')[0]; } ''"
        }
      }
    },
    {
      "taskCode": "SplitProperty-genre-en",
      "taskClass": "SplitProperty",
      "taskConfigurationTemplate": {
        "params": {
          "property": ["ute.sku.channel.genre.en"],
          "separator": ","
        }
      }
    },
    {
      "taskCode": "SplitProperty-genre-fr",
      "taskClass": "SplitProperty",
      "taskConfigurationTemplate": {
        "params": {
          "property": ["ute.sku.channel.genre.fr"],
          "separator": ","
        }
      }
    },
    {
      "taskCode": "SplitProperty-subgenre-en",
      "taskClass": "SplitProperty",
      "taskConfigurationTemplate": {
        "params": {
          "property": ["ute.sku.channel.subgenre.en"],
          "separator": ","
        }
      }
    },
    {
      "taskCode": "SplitProperty-subgenre-fr",
      "taskClass": "SplitProperty",
      "taskConfigurationTemplate": {
        "params": {
          "property": ["ute.sku.channel.subgenre.fr"],
          "separator": ","
        }
      }
    },
    {
      "taskCode": "KeepUniqueValues-",
      "taskClass": "KeepUniqueValues",
      "taskConfigurationTemplate": {
        "params": {
          "property": [
            "ute~sku~channel~system~ids",
            "ute~sku~channel~channelNumbers",
            "ute.*",
            "ute~*"
          ]
        }
      }
    },
    {
      "taskCode": "CreateTombstoneProperties",
      "taskClass": "CreateProperties",
      "taskConfigurationTemplate": {
        "params": {
          "propertyNames": [
            "ute~recordType",
            "ute~recordClass",
            "ute~sourceSystem",
            "ute~lineOfBusiness",
            "ute~language",
            "ute~site",
            "ute~sku~channel~ondemand"
          ],
          "propertyValues": [
            "sku",
            "channel",
            ["clicc", "teamsite", "pom"],
            "digitalCable",
            ["EN", "FR"],
            "rogers",
            "0"
          ]
        }
      }
    },
    {
      "taskCode": "UpdateTombstoneProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"SERVICE_ID", "target":"ute~id"},
            {"source":"SERVICE_NAME_EN_EXTERNAL", "target":"ute~name"},
            {"source":"SERVICE_NAME_FR_EXTERNAL", "target":"ute~name~fr"},
            {"source":"systemId", "target":"ute~sku~channel~system~id"}
          ]
        }
      }
    },
    {
      "taskCode": "UpdateRecordClassProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"SERVICE_CALLSIGN", "target":"ute~sku~channel~callsign"},
            {"source":"CATEGORY_NAME", "target":"ute~sku~channel~category"}
          ]
        }
      }
    },
    {
     "taskCode": "getChannelLineup1",
     "taskClass": "CopyProperties",
     "taskConfigurationTemplate": {
       "params": {
         "copyProperties": [{"source":"ute~sku~channel~system~id", "target":"ute~sku~channel~channelLineup"}]
       }
     }
   },
    {
     "taskCode": "getChannelLineup2",
     "taskClass": "ReplacePropertyValues",
     "taskConfigurationTemplate": {
       "params": {
         "property": ["ute~sku~channel~channelLineup"],
         "pattern": "HD",
         "replacement": ""
       }
     }
   },
    {
     "taskCode": "getChannelLineup3",
     "taskClass": "ReplacePropertyValues",
     "taskConfigurationTemplate": {
       "params": {
         "property": ["ute~sku~channel~channelLineup"],
         "pattern": "DA",
         "replacement": ""
       }
     }
   },
   {
      "taskCode": "CopyMultipleProperties",
      "taskClass": "CopyProperties",
      "taskConfigurationTemplate": {
        "params": {
          "copyProperties": [
            {"source":"ute~name", "target":"ute~sku~channel~name~en"},
            {"source":"ute~name~fr", "target":"ute~sku~channel~name~fr"},
            {"source":"ute~province", "target":"ute~sku~channel~province"}
          ]
        }
      }
    },
    {
     "taskCode": "runscriptSkuDigitalCable",
     "taskClass": "RunScriptComponent",
     "taskConfigurationTemplate": {
       "params": {
         "script":
         "dataRecord['ute~internal~id'] =  _.snakeCase(dataRecord['ute~recordType'] + '-' + dataRecord['ute~recordClass'] + '-' + dataRecord['ute~lineOfBusiness'] + '-' + dataRecord['ute~id'] + '-' + dataRecord['ute~province'] + '-'+dataRecord['ute~sku~channel~category']+'-'+dataRecord['ute~sku~channel~callsign'] + '-' + dataRecord['ute~sku~channel~system~id'])"
       }
     }
   },
   
   {
      "taskCode": "Create-dateActive-dateInactive",
      "taskClass": "CopyProperties",
      "taskConfigurationTemplate": {
        "params": {
          "copyProperties": [
            {"value":"647460275", "target":"ute~dateActive"},
            {"value":"7274426675", "target":"ute~dateInactive"}
          ]
        }
      }
    },

    
    {
      "taskCode": "ReplacePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "pattern": "~",
          "replacement": ".",
          "property": "*"
        }
      }
    },
    {
      "taskCode": "RemoveEmptyProperties",
      "taskConfigurationTemplate": {
        "params": {
          "property": "*"
        }
      }
    },
    {
      "taskCode": "DataRecordToEndecaXmlFile",
      "taskConfigurationTemplate": {
        "params": {
          "filename": "{DATA_PROCESSING_FOUNDATION}/{TEMPDIRECTORY}/{TASK_FILENAME}.xml"
        }
      }
    }
  ]
}