{
  "tasks": [
    {
      "taskCode": "Shell-RM",
      "taskConfigurationTemplate": {
        "in": {"properties": [
            "SERVICE_ID.raw", 
            "SERVICE_NAME_EN.raw", 
            "SERVICE_NAME_FR.raw", 
            "SERVICE_CALLSIGN.raw", 
            "CATEGORY_NAME.raw"]},
        "params": {
          "options": "-f",
          "filename": "{DATA_PROCESSING_FOUNDATION}/{TEMPDIRECTORY}/{TASK_FILENAME}.xml"
        }
      }
    },
    {
      "taskCode": "UniqueDataRecordPropertiesToDataRecord",
      "taskConfigurationTemplate": {
        "in": {"properties": [
            "SERVICE_ID.raw", 
            "SERVICE_NAME_EN.raw", 
            "SERVICE_NAME_FR.raw", 
            "SERVICE_CALLSIGN.raw", 
            "CATEGORY_NAME.raw"]},
        "params": {
            "datareposervice_host": "localhost",
            "datareposervice_port": "40380",
            "customer_code": "rogers",
              "datarepo_code": "eclipse-dev",
              "datarepo_collection_code": "clicc-channels-source"
        }
      }
    },
    {
      "taskCode": "CreateTombstoneProperties",
      "taskClass": "CreateProperties",
      "taskConfigurationTemplate": {
        "params": {
          "propertyNames": [
            "ute~recordType",
            "ute~recordClass",
            "ute~sourceSystem",
            "ute~lineOfBusiness",
            "ute~language",
            "ute~site"
          ],
          "propertyValues": [
            "content",
            "service",
            "clicc",
            "digitalCable",
            ["EN","FR"],
            "rogers"
          ]
        }
      }
    },
    {
      "taskCode": "UpdateTombstoneProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"SERVICE_ID", "target":"ute~id"},
            {"source":"SERVICE_NAME_EN", "target":"ute~name"},
            {"source":"SERVICE_NAME_FR", "target":"ute~name~fr"}
          ]
        }
      }
    },
    {
      "taskCode": "UpdateRecordClassProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"SERVICE_CALLSIGN", "target":"ute~content~service~callsign"},
            {"source":"CATEGORY_NAME", "target":"ute~content~service~category"}
          ]
        }
      }
    },
    {
      "taskCode": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [

            {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "clicc-channels-source",
              "baseRecordLookupPropertyName": "ute~id",
              "lookupIdPropertyNames": ["SERVICE_ID"]
              // ,
              // "lookupFilter": {
              //   "propertyName": "PRODUCT_CODE.raw",
              //   "operation": "term",
              //   "value": "DMOV"
              // }
            },
            "enrichConfiguration": {
              "ute~content~service~packages~en": ["$.matchingRecords[*].PRODUCT_INVOICE_DESC"],
              "ute~content~service~packages~fr": ["$.matchingRecords[*].PRODUCT_INVOICE_DESC"],
              "ute~content~service~packages~id": ["$.matchingRecords[*].PRODUCT_CODE"],
              "ute~content~service~packages": ["$.matchingRecords", 
                   {"ute.id": "PRODUCT_CODE",
                   "ute.name.en":"PRODUCT_INVOICE_DESC",
                    "ute.name.fr":"PRODUCT_INVOICE_DESC"}
              ],
              "ute~content~service~systems~en": ["$.matchingRecords[*].SYSTEM_NAME"],
              "ute~content~service~systems~fr": ["$.matchingRecords[*].SYSTEM_NAME"],
              "ute~content~service~systems~id": ["$.matchingRecords[*].SYSTEM_TABNUM"],
              "ute~content~service~systems": ["$.matchingRecords", 
                   {"ute.id": "SYSTEM_TABNUM",
                   "ute.name.en":"SYSTEM_NAME",
                   "ute.name.fr":"SYSTEM_NAME" }
              ],
              "ute~content~service~channelNumbers": ["$.matchingRecords", 
                  {"ute.id": "CHANNEL_ID",
                  "ute.content.channelNumber.number":"CHANNEL_NUM",
                  "ute.content.channelNumber.system.name.en": "SYSTEM_NAME",
                  "ute.content.channelNumber.system.name.fr": "SYSTEM_NAME"
                  }
              ]
            }
          }

        ]
      }
      }
    },
    {
      "taskCode": "KeepUniqueValues",
      "taskConfigurationTemplate": {
        "params": {
          "property": [
            "ute~content~service~packages~en",
            "ute~content~service~packages~fr",
            "ute~content~service~packages~id",
            "ute~content~service~packages",
            "ute~content~service~systems~en",
            "ute~content~service~systems~fr",
            "ute~content~service~systems~id",
            "ute~content~service~systems",
            "ute~content~service~channelNumbers"
          ]
        }
      }
    },
    {
     "taskCode": "runscriptServiceDigitalCable",
     "taskClass": "RunScriptComponent",
     "taskConfigurationTemplate": {
       "params": {
         "script":
         "dataRecord['ute~internal~id'] =  _.snakeCase(dataRecord['ute~recordType'] + '-' + dataRecord['ute~recordClass'] + '-' + dataRecord['ute~lineOfBusiness'] + '-' + dataRecord['ute~sourceSystem'] + '-' + dataRecord['ute~id'])"
       }
     }
   },
//    {
//      "taskCode": "Debug",
//      "taskConfigurationTemplate": {
//        "params": {}
//      }
//    },
    {
      "taskCode": "ReplacePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "pattern": "~",
          "replacement": ".",
          "property": "*"
        }
      }
    }
    ,
     {
       "taskCode": "DataRecordToEndecaXmlFile",
       "taskConfigurationTemplate": {
         "params": {
           "filename": "{DATA_PROCESSING_FOUNDATION}/{TEMPDIRECTORY}/{TASK_FILENAME}.xml"
         }
       }
     }
  ]
}