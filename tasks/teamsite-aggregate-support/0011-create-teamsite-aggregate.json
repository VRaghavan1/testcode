{
  "tasks": [
    {
      "taskCode": "DataRepositoryToDataRecordBulk",
      "taskConfigurationTemplate": {
        "in": "",
        "params": {
          "datareposervice_host": "{DATA_REPOSITORY_SERVICE_HOST}",
          "datareposervice_port": "{DATA_REPOSITORY_SERVICE_PORT}",
          "customer_code": "{CUSTOMER_CODE}",
          "datarepo_code": "{DATA_REPOSITORY_CODE}",
          "datarepo_collection_code": "teamsite-new-content-record"
        }
      }
    },
    {
      "taskClass": "FilterDataRecord",
      "taskCode": "FilterDataRecord-RecordType",
      "taskConfigurationTemplate": {
        "params": {
          "condition": {
            "$or": [
              {"ute~content~support~page_type": {"$eq": "N"}},
              {"ute~content~support~page_type": {"$exists": false}}
            ]            
          }
        }
      }
    },
    {
      "taskCode": "GetParent",
      "taskClass": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [

            {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "teamsite-new-content-record",
              "baseRecordLookupPropertyName": "ute~seo~pageTitle~en",
              "lookupIdPropertyNames": ["ute~seo~pageTitle~en.raw"],
              "lookupFilter": {
                "propertyName": "ute~content~support~page_type.raw",
                "operation": "term",
                "value": "Y"
              }
            },
            "enrichConfiguration": {
                "ute~content~support~content_id": "$.matchingRecords[*].ute~content~support~content_id"
            }
          }
        ]
      }
      }
    },

    {
     "taskCode": "RunScriptComponent-101",
     "taskClass": "RunScriptComponent",
     "taskConfigurationTemplate": {
       "params": {
         "script":
         "dataRecord['ute~content~support~seoUrl'] = !_.isEmpty(dataRecord['ute~content~support~content_id']) ? dataRecord['ute~content~support~content_id'] : _.kebabCase(dataRecord['ute~seo~pageTitle~en']);"
       }
     }
    },


{
      "taskCode": "GetChildCount-1",
      "taskClass": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [
            {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "teamsite-new-content-record",
              "baseRecordLookupPropertyName": "ute~seo~pageTitle~en",
              "lookupIdPropertyNames": ["ute~seo~pageTitle~en.raw"]
            },
            "enrichConfiguration": {
                "childCount": ["$.matchingRecords[*].ute~seo~pageTitle~en"]
            }
          }
        ]
      }
      }
    },
    {
       "taskCode": "GetChildCount-2",
       "taskClass": "RunScriptComponent",
       "taskConfigurationTemplate": {
         "params": {
           "script":
           "dataRecord['childCount'] = dataRecord['childCount'].length;"
         }
       }
     },
    {
      "description": "If there are no other articles in this group (i.e. this is a standalone article), set searchable to 'true'",
      "taskCode": "MarkAsNotSearchable",
      "taskClass": "RunScriptComponent",
      "taskConfigurationTemplate": {
      "params": {
        "script":
        "dataRecord['ute~content~support~isSearchable'] = dataRecord['childCount'] < 2 ? 'true' : 'false';"
       }
     }
    },

    {
      "taskCode": "CopyProperties",
      "taskConfigurationTemplate": {
        "params": {
          "copyProperties": [
            {"source":"ute~content~support~display_from_date_hidden", "target":"ute~dateActive", "default": "647460275"},
            {"source":"ute~content~support~display_to_date_hidden", "target":"ute~dateInactive", "default": "7274426675"}
          ]
        }
      }
    },

    {
      "taskCode": "Set-internal-id",
      "taskClass": "RunScriptComponent",
      "taskConfigurationTemplate": {
        "params": {
          "script":
          "dataRecord['ute~internal~id'] = dataRecord['ute~content~support~date_created_hidden'] ? (_.snakeCase(dataRecord['ute~content~support~content_id']) + '-' + dataRecord['ute~content~support~date_created_hidden']) : dataRecord['ute~internal~id'];"
        }
      }   
    },

    {
      "taskCode": "ReplacePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "pattern": "ute~content~support~is_active",
          "replacement": "ute~is_active",
          "property": "ute~content~support~is_active"
        }
      }
    },
  //  {
  //    "taskCode": "Debug",
  //    "taskConfigurationTemplate": {
  //      "params": {}
  //    }
  //  },
    {
      "taskCode": "DataRecordToDataRepositoryBulk",
      "taskConfigurationTemplate": {
        "params": {
          "customerCode": "rogers",
          "dataRepositoryCode": "eclipse-dev",
          "dataCollectionCode": "teamsite-aggregate-content-record"
        }
      }
    }

  ]
}