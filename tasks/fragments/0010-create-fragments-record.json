
{
  "tasks": [
    {
      "taskCode": "RemoveDataCollection-fragments-record",
      "taskClass": "RemoveDataCollection",
      "taskConfigurationTemplate": {
        "in": {},
        "params": {
          "customerCode": "rogers",
          "dataRepositoryCode": "eclipse-dev",
          "dataCollectionCode": "fragments-record",
          "successIfNotExists": true
        }
      }
    },
    {
      "taskCode": "CreateDataCollection-fragments-record",
      "taskClass": "CreateDataCollection",
      "taskConfigurationTemplate": {
        "params": {
          "customerCode": "rogers",
          "dataRepositoryCode": "eclipse-dev",
          "dataCollectionCode": "fragments-record",
          "dataRecordIdentifierProperty": "id",
          "name": "Fragments"
        }
      }
    },
    {
      "taskCode": "DataRepositoryToDataRecordBulk",
      "taskConfigurationTemplate": {
        "params": {
          "datareposervice_host": "{DATA_REPOSITORY_SERVICE_HOST}",
          "datareposervice_port": "{DATA_REPOSITORY_SERVICE_PORT}",
          "customer_code": "{CUSTOMER_CODE}",
          "datarepo_code": "{DATA_REPOSITORY_CODE}",
          "datarepo_collection_code": "fragments-source"
        }
      }
    },
    {
      "taskCode": "CreateTombstoneProperties",
      "taskClass": "CreateProperties",
      "taskConfigurationTemplate": {
        "params": {
          "propertyNames": [
            "ute~recordType",
            "ute~recordClass",
            "ute~sourceSystem",
            "ute~lineOfBusiness",
            "ute~language"
          ],
          "propertyValues": [
            "supplemental",
            "fragment",
            "teamsite",
            "all",
            ["EN", "FR"]
          ]
        }
      }
    },
    {
      "taskCode": "CopyProperties-1",
      "taskClass": "CopyProperties",
      "taskConfigurationTemplate": {
        "params": {
          "copyProperties": [
            {"source":"publish_attributes.is_active", "target":"ute~supplemental~fragment~isActive"},
            {"source":"publish_attributes.is_highlight", "target":"ute~supplemental~fragment~isHighlight"},
            {"source":"publish_attributes.highlight_icon", "target":"ute~supplemental~fragment~highlight_icon"},
            {"source":"publish_attributes.contentid", "target":"ute~supplemental~fragment~contentId"},
            {"source":"publish_attributes.province_selection", "target":"ute~province"},
            {"source":"publish_attributes.english.en_content", "target":"ute~supplemental~fragment~html~en"},
            {"source":"publish_attributes.french.fr_content", "target":"ute~supplemental~fragment~html~fr"},
            {"source":"date_created_hidden", "target":"ute~supplemental~fragment~date_created_hidden"},
            {"source":"date_modified_hidden", "target":"ute~supplemental~fragment~date_modified_hidden"}
          ]
        }
      }
    },
    {
       "taskCode": "runScriptAddUniqueId",
       "taskClass": "RunScriptComponent",
       "taskConfigurationTemplate": {
         "params": {
           "script":
            "dataRecord['ute~internal~id'] = dataRecord['ute~supplemental~fragment~date_created_hidden'] ? (_.snakeCase(dataRecord['ute~content~support~content_id']) + '-' + dataRecord['ute~supplemental~fragment~date_created_hidden']) : (_.snakeCase(dataRecord['ute~recordType'] + '-' + dataRecord['ute~recordClass'] + '-' + dataRecord['ute~sourceSystem'] + '-' + dataRecord['ute~supplemental~fragment~contentId']));"
         }
       }
     },

    {
       "taskCode": "runScript-GetID",
       "taskClass": "RunScriptComponent",
       "taskConfigurationTemplate": {
         "params": {
           "script":
           "dataRecord['ute~id'] = dataRecord['ute~internal~id'];"
         }
       }
     },
    {
       "taskCode": "runScript-CapsProvince",
       "taskClass": "RunScriptComponent",
       "taskConfigurationTemplate": {
         "params": {
           "script":
           "dataRecord['ute~province'] = _.toUpper(dataRecord['ute~province']);"
         }
       }
     },
    {
      "taskCode": "SplitProperty",
      "taskConfigurationTemplate": {
        "params": {
          "property": ["ute~province"],
          "separator": ","
        }
      }
    },
    {
      "taskCode": "TrimProperties",
      "taskConfigurationTemplate": {
        "params": {
          "property": ["ute~province"]
        }
      }
    },
    {
      "taskCode": "PickProperties",
      "taskConfigurationTemplate": {
        "params": {
          "properties": ["ute~*"]
        }
      }
    },
    {
      "taskCode": "Debug",
      "taskConfigurationTemplate": {
        "params": {}
      }
    },
    {
      "taskCode": "DataRecordToDataRepositoryBulk",
      "taskConfigurationTemplate": {
        "params": {
          "customerCode": "rogers",
          "dataRepositoryCode": "eclipse-dev",
          "dataCollectionCode": "fragments-record"
        }
      }
    }
  ]
}