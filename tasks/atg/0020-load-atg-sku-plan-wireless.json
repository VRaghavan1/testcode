{
  "tasks": [
    {
      "taskCode": "Shell-RM",
      "taskConfigurationTemplate": {
        "in": "",
        "params": {
          "options": "-f",
          "filename": "{DATA_PROCESSING_FOUNDATION}/{TEMPDIRECTORY}/{TASK_FILENAME}.xml"
        }
      }
    },
    {
      "taskCode": "DataRepositoryToDataRecordBulk",
      "taskConfigurationTemplate": {
        "params": {
          "datareposervice_host": "{DATA_REPOSITORY_SERVICE_HOST}",
          "datareposervice_port": "{DATA_REPOSITORY_SERVICE_PORT}",
          "customer_code": "rogers",
          "datarepo_code": "eclipse-dev",
          "datarepo_collection_code": "atg-ute-pc"}
      }
    },
    {
      "taskClass": "FilterDataRecord",
      "taskCode": "FilterDataRecord-RecordType",
      "taskConfigurationTemplate": {
        "params": {
          "condition": {
            "record~type": {"$in": ["postpaidPlanSoc", "sharedPricePlanSoc"]}
          }
        }
      }
    },
    {
      "taskClass": "FilterDataRecord",
      "taskCode": "FilterDataRecord-Site",
      "taskConfigurationTemplate": {
        "params": {
          "condition": {
            "sku~siteId": {"$eq": "{SITE}"}
          }
        }
      }
    },
    {
      "taskCode": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [
            {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "atg-ute-price",
              "baseRecordLookupPropertyName": "sku~prices",
              "lookupIdPropertyNames": ["price~repositoryId"]
            },
            "enrichConfiguration": {
              "ute~sku~plan~wireless~price.listPrice": ["$.matchingRecords[*]['price~listPrice']"]
            }
          },
          {
          "matchConfiguration": {
            "customerCode": "rogers",
            "dataRepositoryCode": "eclipse-dev",
            "dataCollectionCode": "atg-ute-feature",
            "baseRecordLookupPropertyName": "sku~feature~id",
            "lookupIdPropertyNames": ["feature~repositoryId"]
          },
          "enrichConfiguration": {
            "ute~sku~plan~wireless~feature~name": ["$.matchingRecords[*]['feature~definition~displayName_en']"],
            "ute~sku~plan~wireless~feature~name~fr": ["$.matchingRecords[*]['feature~definition~displayName_fr'"]
          }
        },

          {
          "matchConfiguration": {
            "customerCode": "rogers",
            "dataRepositoryCode": "eclipse-dev",
            "dataCollectionCode": "atg-ute-sku-group",
            "baseRecordLookupPropertyName": "postpaidPlanSoc~planCategory",
            "lookupIdPropertyNames": ["abstractGroup~repositoryId"]
          },
          "enrichConfiguration": {
            "ute~sku~plan~wireless~planCategory": [
              "$.matchingRecords[*]['abstractGroup~key']"
            ]
          }
        },
        {
        "matchConfiguration": {
          "customerCode": "rogers",
          "dataRepositoryCode": "eclipse-dev",
          "dataCollectionCode": "atg-ute-sku-group",
          "baseRecordLookupPropertyName": "postpaidPlanSoc~term",
          "lookupIdPropertyNames": ["abstractGroup~repositoryId"]
        },
        "enrichConfiguration": {
          "ute~sku~plan~wireless~term": [
            "$.matchingRecords[*]['abstractGroup~key']"
          ]
        }
      }
        ]
        }
      }
    },
    {
      "taskCode": "CreateTombstoneProperties",
      "taskClass": "CreateProperties",
      "taskConfigurationTemplate": {
        "params": {
          "propertyNames": [
            "ute~recordType",
            "ute~recordClass",
            "ute~sourceSystem",
            "ute~lineOfBusiness",
            "ute~language"
          ],
          "propertyValues": [
            "sku",
            "plan",
            "atg",
            "wireless",
            ["EN","FR"]
          ]
        }
      }
    },
    {
      "taskCode": "UpdateTombstoneProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"sku~repositoryId", "target":"ute~id"},
            {"source":"sku~siteId", "target":"ute~site"},
            {"source":"sku~displayName", "target":"ute~name~en"},
            {"source":"sku~displayName_fr", "target":"ute~name~fr"},
            {"source":"sku~description", "target":"ute~description"},
            {"source":"sku~description_fr", "target":"ute~description~fr"}
          ]
        }
      }
    },
    {
      "taskCode": "UpdateRecordTypeProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"sku~endDate", "target":"ute~sku~endDate"},
            {"source":"sku~startDate", "target":"ute~sku~startDate"},
            {"source":"sku~onSale", "target":"ute~sku~onSale"}
          ]
        }
      }
    },
    {
      "taskCode": "UpdateRecordClassProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"sku~prices", "target":"ute~sku~plan~wireless~price~id"},
            {"source":"sku~feature~id", "target":"ute~sku~plan~wireless~feature~id"},
            {"source":"planSoc~compatibleAddons", "target":"ute~sku~plan~wireless~compatibleAddons~id"},
            {"source":"isShareEvolutionDiscountable", "target":"ute~sku~plan~wireless~isShareEvolutionDiscountable"},
            {"source":"minimumSubscribers", "target":"ute~sku~plan~wireless~minimumSubscribers"},
            {"source":"sharingType", "target":"ute~sku~plan~wireless~sharingType"},
            {"source":"msdPlan", "target":"ute~sku~plan~wireless~msdPlan"},
            {"source":"sterlingDevice", "target":"ute~sku~plan~wireless~sterlingDevice"},
            {"source":"isMigratedPlan", "target":"ute~sku~plan~wireless~isMigratedPlan"},
            {"source":"planSoc", "target":"ute~sku~plan~wireless~planSoc"},
            {"source":"compatibleForAllDevices", "target":"ute~sku~plan~wireless~compatibleForAllDevices"},
            {"source":"planSoc~planType", "target":"ute~sku~plan~wireless~planType~id"}
          ]
        }
      }
    },
    {
       "taskCode": "runScriptAtgSkuPlanWireless",
       "taskClass": "RunScriptComponent",
       "taskConfigurationTemplate": {
         "params": {
           "script":
           "dataRecord['ute~internal~id'] =  _.snakeCase(dataRecord['ute~recordType'] + '-' + dataRecord['ute~recordClass'] + '-' + dataRecord['ute~lineOfBusiness'] + '-' + dataRecord['ute~id'])"
         }
       }
     },
    {
      "taskCode": "ReplacePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "pattern": "~",
          "replacement": ".",
          "property": "*"
        }
      }
    },
    {
      "taskCode": "PickProperties",
      "taskConfigurationTemplate": {
        "params": {
          "properties": ["ute.*"]
        }
      }
    },
    {
      "taskCode": "ReplacePropertyValues",
      "taskConfigurationTemplate": {
        "params": {
          "pattern": "\n",
          "replacement": "",
          "property": ["ute.name.en","ute.name.fr"]
        }
      }
    },
//    {
//      "taskCode": "Debug",
//      "taskConfigurationTemplate": {
//      }
//    },
    {
      "taskCode": "DataRecordToEndecaXmlFile",
      "taskConfigurationTemplate": {
        "params": {
          "filename": "{DATA_PROCESSING_FOUNDATION}/{TEMPDIRECTORY}/{TASK_FILENAME}.xml"
        }
      }
    }
  ]
}
