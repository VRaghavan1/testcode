
{
  "tasks": [
    {
      "taskCode": "DataRepositoryToDataRecordBulk",
      "taskConfigurationTemplate": {
        "in" : {},
        "params": {
          "datareposervice_host": "{DATA_REPOSITORY_SERVICE_HOST}",
          "datareposervice_port": "{DATA_REPOSITORY_SERVICE_PORT}",
          "customer_code": "{CUSTOMER_CODE}",
          "datarepo_code": "{DATA_REPOSITORY_CODE}",
          "datarepo_collection_code": "atg-ute-pc"}
      }
    },
    {
      "taskClass": "FilterDataRecord",
      "taskCode": "FilterDataRecord-RecordType",
      "taskConfigurationTemplate": {
        "params": {
          "condition": {
            "record~type": {"$all": ["deviceSku"]}
          }
        }
      }
    },
    {
      "taskClass": "FilterDataRecord",
      "taskCode": "FilterDataRecord-Site",
      "taskConfigurationTemplate": {
        "params": {
          "condition": {
            "sku~siteId": {"$eq": "{SITE}"}
          }
        }
      }
    },
    {
      "taskCode": "HydrateDataRecord",
      "taskConfigurationTemplate": {
        "params": {
          "hydrate_configuration": [
            {
            "matchConfiguration": {
              "customerCode": "rogers",
              "dataRepositoryCode": "eclipse-dev",
              "dataCollectionCode": "atg-ute-price",
              "baseRecordLookupPropertyName": "sku~prices",
              "lookupIdPropertyNames": ["price~repositoryId"]
            },
            "enrichConfiguration": {
              "ute~sku~device~wireless~price.listPrice": ["$.matchingRecords[*]['price~listPrice']"]
            }
          },
          {
          "matchConfiguration": {
            "customerCode": "rogers",
            "dataRepositoryCode": "eclipse-dev",
            "dataCollectionCode": "atg-ute-feature",
            "baseRecordLookupPropertyName": "sku~feature~id",
            "lookupIdPropertyNames": ["feature~repositoryId"]
          },
          "enrichConfiguration": {
            "ute~sku~device~wireless~feature~name": "$.matchingRecords[*]['feature~definition~displayName_en']",
            "ute~sku~device~wireless~feature~name~fr": "$.matchingRecords[*]['feature~definition~displayName_fr']"
          }
        }
        ]
        }
      }
    },
    {
      "taskCode": "CreateTombstoneProperties",
      "taskClass": "CreateProperties",
      "taskConfigurationTemplate": {
        "params": {
          "propertyNames": [
            "ute~recordType",
            "ute~recordClass",
            "ute~sourceSystem",
            "ute~lineOfBusiness",
            "ute~language"
          ],
          "propertyValues": [
            "sku",
            "device",
            "atg",
            "wireless",
            ["EN","FR"]
          ]
        }
      }
    },
    {
      "taskCode": "UpdateTombstoneProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"sku~repositoryId", "target":"ute~id"},
            {"source":"sku~siteId", "target":"ute~site"},
            {"source":"sku~displayName", "target":"ute~name~en"},
            {"source":"sku~displayName_fr", "target":"ute~name~fr"}
          ]
        }
      }
    },
    {
      "taskCode": "UpdateRecordTypeProperties",
      "taskClass": "ChangePropertyNames",
      "taskConfigurationTemplate": {
        "params": {
          "replacePropertyNames": [
            {"source":"sku~endDate", "target":"ute~sku~endDate"},
            {"source":"sku~startDate", "target":"ute~sku~startDate"},
            {"source":"sku~onSale", "target":"ute~sku~onSale"}
          ]
        }
      }
    },
    {
       "taskCode": "runScriptAtgSkuDeviceWireless",
       "taskClass": "RunScriptComponent",
       "taskConfigurationTemplate": {
         "params": {
           "script":
           "dataRecord['ute~internal~id'] =  _.snakeCase(dataRecord['ute~recordType'] + '-' + dataRecord['ute~recordClass'] + '-' + dataRecord['ute~lineOfBusiness'] + '-' + dataRecord['ute~id'])"
         }
       }
     },
    // {
    //   "taskCode": "PickProperties",
    //   "taskConfigurationTemplate": {
    //     "params": {
    //       "properties": ["ute~*"]
    //     }
    //   }
    // },



    {
      "taskCode": "CopyProperties",
      "taskConfigurationTemplate": {
        "params": {
          "copyProperties": [
            {"target":"dimval~unique_id", "source": "ute~internal~id"},
            {"target":"dimval~spec","source": "ute~name~en"},
            {"target":"dimval~display_name","source": "ute~name~en"},
            {"target":"dimval~dimension_name","value": "ute.sku.device.typeahead.en"},
            {"target":"dimval~display_order","value": ""},
            {"target":"dimval~parent_spec","value": "/"},
            {"target":"dimval~match~use_spec","value": "TRUE"},
            {"target":"dimval~search_synonym","value": ""},
            {"target":"dimval~range~lower_bound","value": ""},
            {"target":"dimval~range~lower_bound_inclusive","value": ""},
            {"target":"dimval~range~upper_bound","value": ""},
            {"target":"dimval~range~upper_bound_inclusive","value": ""},

            {"target":"ute~recordType", "source": "ute~recordType"},
            {"target":"ute~recordClass", "source": "ute~recordClass"},
            {"target":"ute~lineOfBusiness", "source": "ute~lineOfBusiness"},
            {"target":"url", "value": ""},
            {"target":"image", "source": ""}
          ]
        }
      }
    },
    {
      "taskCode": "PickProperties",
      "taskConfigurationTemplate": {
        "params": {
          "properties": [
            "dimval~unique_id",
            "dimval~spec",
            "dimval~display_name",
            "ute~recordType",
            "ute~recordClass",
            "ute~lineOfBusiness",
            "url",
            "dimval~dimension_name",
            "dimval~display_order",
            "dimval~parent_spec",
            "dimval~match~use_spec",
            "dimval~search_synonym",
            "dimval~range~lower_bound",
            "dimval~range~lower_bound_inclusive",
            "dimval~range~upper_bound",
            "dimval~range~upper_bound_inclusive",
            "image"
          ]
        }
      }
    },
    {
     "taskCode": "Debug",
     "taskConfigurationTemplate": {
       "params": {}
     }
    }
    // {
    //   "taskCode": "DataRecordToDataRepositoryBulk",
    //   "taskConfigurationTemplate": {
    //     "params": {
    //       "customerCode": "rogers",
    //       "dataRepositoryCode": "eclipse-dev",
    //       "dataCollectionCode": "typeahead-record"
    //     }
    //   }
    // }
    ]
}